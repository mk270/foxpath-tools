- name: Aid Type
  tests:
   - name: Default aid type
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `default-aid-type` should be present
      or `transaction/aid-type` should be present

   - name: Aid type uses standard codelist
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then at least one `default-aid-type/@code` should be on the AidType codelist
      or at least one `transaction/aid-type/@code` should be on the AidType codelist

- name: Allocation policy
  tests:
   - name: Allocation policy
     level: 3
     expression: >
      `document-link/category[@code="B04"]` should be present

- name: Annual report
  tests:
   - name: Annual report
     level: 3
     expression: >
      `document-link/category[@code="B01"]` should be present

- name: Audit
  tests:
   - name: Audit
     level: 3
     expression: >
      `document-link/category[@code="B06"]` should be present

- name: Budget Docs
  tests:
   - name: Document - Budget document
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `default-aid-type/@code` is not A01
      and `transaction/aid-type/@code` is not A01
      then `document-link/category[@code="A05"]` should be present

- name: Budget Identifier
  tests:
   - name: Budget identifier, administrative/functional classification
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `default-aid-type/@code` is not A01
      and `default-aid-type/@code` is not A02
      and `transaction/aid-type/@code` is not A01
      and `transaction/aid-type/@code` is not A02
      then at least one `country-budget-items[@vocabulary="1"]/budget-item/@code` should be on the BudgetIdentifier codelist

   - name: Budget identifier, economic classification
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `default-aid-type/@code` is not A01
      and `default-aid-type/@code` is not A02
      and `transaction/aid-type/@code` is not A01
      and `transaction/aid-type/@code` is not A02
      then `capital-spend` should be present

- name: Collaboration Type
  tests:
   - name: Collaboration type
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `collaboration-type` should be present

   - name: Collaboration type uses standard codelist
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then at least one `collaboration-type/@code` should be on the CollaborationType codelist

- name: Contact details
  tests:
   - name: Contact information for the activity
     level: 1
     expression: >
      `contact-info` should be present

- name: Contracts
  tests:
   - name: Document - Contract
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `default-aid-type/@code` is not A01
      and `transaction/aid-type/@code` is not A01
      then `document-link/category[@code="A06"]` should be present
      or `document-link/category[@code="A11"]` should be present

- name: Budget
  tests:
   - name: Budget
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `budget` should be available forward annually
      or `planned-disbursement` should be available forward annually

   - name: Budget, by quarters
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `budget` should be available forward quarterly
      or `planned-disbursement` should be available forward quarterly

- name: Current Status
  tests:
   - name: Activity status
     level: 1
     expression: >
      `activity-status` should be present

   - name: Activity status, only once
     level: 1
     expression: >
      at least one `activity-status/@code` should be on the ActivityStatus codelist

- name: Actual dates
  tests:
   - name: Activity date actual end date
     level: 1
     expression: >
      if `activity-status/@code` is at least 3
      then `activity-date[@type="end-actual"]|activity-date[@type="4"]` should be present

   - name: Activity date actual start date
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `activity-date[@type="start-actual"]|activity-date[@type="2"]` should be present

- name: Planned dates
  tests:
   - name: Activity date planned end date
     level: 1
     expression: >
      `activity-date[@type="end-planned"]|activity-date[@type="3"]` should be present

   - name: Activity date planned start date
     level: 1
     expression: >
      `activity-date[@type="start-planned"]|activity-date[@type="1"]` should be present

- name: Description
  tests:
   - name: Description
     level: 1
     expression: >
      `description/text()|description/narrative/text()` should be present

   - name: Description, more than 40 chars
     level: 1
     expression: >
      `description/text()|description/narrative/text()` should have more than 40 characters

- name: Evaluations
  tests:
   - name: Document - Review of project performance and evaluation document
     level: 1
     expression: >
      if `activity-status/@code` is at least 3
      then `document-link/category[@code="A07"]` should be present

- name: Disbursements and expenditure
  tests:
   - name: Disbursements
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then
      `transaction/transaction-type[@code="D"] |
       transaction/transaction-type[@code="3"]`
      should be present
      or
      `transaction/transaction-type[@code="E"] |
       transaction/transaction-type[@code="4"]`
      should be present

- name: Commitments
  tests:
   - name: Commitments
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `transaction/transaction-type[@code="C"]` should be present
      or `transaction/transaction-type[@code="2"]` should be present

- name: Finance Type
  tests:
   - name: Default finance type
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `default-finance-type` should be present
      or `transaction/finance-type` should be present

   - name: Finance type uses standard codelist
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then at least one `default-finance-type/@code` should be on the FinanceType codelist
      or at least one `transaction/finance-type/@code` should be on the FinanceType codelist

- name: Flow Type
  tests:
   - name: Flow type
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `default-flow-type` should be present
      or `transaction/flow-type` should be present

   - name: Flow type uses standard codelist
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then at least one `default-flow-type/@code` should be on the FlowType codelist
      or at least one `transaction/flow-type/@code` should be on the FlowType codelist

- name: Impact Appraisals
  tests:
   - name: Document - Pre- and post-project impact appraisal
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `document-link/category[@code="A01"]` should be present

- name: Implementer
  tests:
   - name: Implementing organisation
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then
      `participating-org[@role="Implementing"] |
       participating-org[@role="4"]` should be present

- name: Sub-national location
  tests:
   - name: Location (sub-national)
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `recipient-region/@code` is not 998
      then `location` should be present

   - name: Location (sub-national) coordinates or point
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `recipient-region/@code` is not 998
      then `location/coordinates` should be present
      or `location/point` should be present

- name: MoU
  tests:
   - name: Document - Memorandum of understanding document
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `document-link/category[@code="A09"]` should be present

- name: Objectives
  tests:
   - name: Document - Objectives / Purpose of activity document
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `document-link/category[@code="A02"]` should be present
      or `description[@type="2"]` should be present

- name: Procurement policy
  tests:
   - name: Procurement policy
     level: 3
     expression: >
      `document-link/category[@code="B05"]` should be present

- name: Sector
  tests:
   - name: Sector
     level: 1
     expression: >
      `sector` should be present
      or `transaction/sector` should be present

   - name: Sector uses standard codelist
     level: 1
     expression: >
      at least one
        `sector[@vocabulary="DAC"]/@code |
         sector[not(@vocabulary)]/@code |
         sector[@vocabulary="1"]/@code |
         transaction/sector[@vocabulary="1"]/@code |
         transaction/sector[not(@vocabulary)]/@code`
      should be on the Sector codelist

- name: Strategy
  tests:
   - name: Strategy
     level: 3
     expression: >
      `document-link/category[@code="B02"]` should be present

- name: Tenders
  tests:
   - name: Document - Tender
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      and `default-aid-type/@code` is not A01
      and `transaction/aid-type/@code` is not A01
      then `document-link/category[@code="A10"]` should be present

- name: Tied Aid Status
  tests:
   - name: Tied aid status
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `default-tied-status` should be present
      or `transaction/tied-status` should be present

   - name: Tied aid status uses standard codelist
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then at least one `default-tied-status/@code` should be on the TiedStatus codelist
      or at least one `transaction/tied-status/@code` should be on the TiedStatus codelist

- name: Title
  tests:
   - name: Title
     level: 1
     expression: >
      `title/text()|title/narrative/text()` should be present

   - name: Title, more than 10 chars
     level: 1
     expression: >
      `title/text()|title/narrative/text()` should have more than 10 characters

- name: Unique ID
  tests:
   - name: Unique IATI Identifier
     level: 1
     expression: >
      `iati-identifier` should be present

   - name: IATI Identifier starts with reporting org ref
     level: 1
     expression: >
      `iati-identifier/text()`
        should start with `reporting-org/@ref`
      or `iati-identifier/text()`
        should start with `other-identifier[@type="B1"]/@ref`

- name: Conditions
  tests:
   - name: Conditions data
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `conditions` should be present

   - name: Conditions document
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `document-link/category[@code="A04"]` should be present

- name: Results
  tests:
   - name: Results data
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `result` should be present

   - name: Results document
     level: 1
     expression: >
      if `activity-status/@code` is at least 2
      then `document-link/category[@code="A08"]` should be present

- name: ""
  tests:
   - name: Current data
     level: 1
     expression: >
      `activity-date[@type="end-planned"]/@iso-date |
       activity-date[@type="end-planned"]/text() |
       activity-date[@type="3"]/@iso-date |
       activity-date[@type="3"]/text()`
      is less than 12 months ago
      or
      `activity-date[@type="end-actual"]/@iso-date |
       activity-date[@type="end-actual"]/text() |
       activity-date[@type="4"]/@iso-date |
       activity-date[@type="4"]/text()`
      is less than 12 months ago
      or
      for any
      `transaction[transaction-type/@code="D"] |
       transaction[transaction-type/@code="E"] |
       transaction[transaction-type/@code="3"] |
       transaction[transaction-type/@code="4"]`,
      `transaction-date/@iso-date` is less than 12 months ago
